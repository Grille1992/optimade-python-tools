<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Documentation for the OPTIMADE Python tools" name="description"/><link href="https://www.optimade.org/optimade-python-tools/api_reference/validator/validator/" rel="canonical"/><link href="../../../images/favicon.png" rel="shortcut icon"/><meta content="mkdocs-1.1.2, mkdocs-material-5.5.3" name="generator"/><title>validator - OPTIMADE Python tools</title><link href="../../../assets/stylesheets/main.947af8d5.min.css" rel="stylesheet"/><link href="../../../assets/stylesheets/palette.7f672a1f.min.css" rel="stylesheet"/><meta content="" name="theme-color"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link href="../../../css/reference.css" rel="stylesheet"/></head> <body data-md-color-accent="red" data-md-color-primary="black" data-md-color-scheme="default" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#validator"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header" data-md-component="header"> <nav aria-label="Header" class="md-header-nav md-grid"> <a aria-label="OPTIMADE Python tools" class="md-header-nav__button md-logo" href="https://www.optimade.org/optimade-python-tools/" title="OPTIMADE Python tools"> <img alt="logo" src="../../../images/optimade_logo_180x180.svg"/> </a> <label class="md-header-nav__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg> </label> <div class="md-header-nav__title" data-md-component="header-title"> <div class="md-header-nav__ellipsis"> <span class="md-header-nav__topic md-ellipsis"> OPTIMADE Python tools </span> <span class="md-header-nav__topic md-ellipsis"> validator </span> </div> </div> <label class="md-header-nav__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </label> <button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg> </button> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix=""> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list"></ol> </div> </div> </div> </div> </div> <div class="md-header-nav__source"> <a class="md-source" href="https://github.com/Materials-Consortia/optimade-python-tools" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> </div> <div class="md-source__repository"> optimade-python-tools </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="OPTIMADE Python tools" class="md-nav__button md-logo" href="https://www.optimade.org/optimade-python-tools/" title="OPTIMADE Python tools"> <img alt="logo" src="../../../images/optimade_logo_180x180.svg"/> </a> OPTIMADE Python tools </label> <div class="md-nav__source"> <a class="md-source" href="https://github.com/Materials-Consortia/optimade-python-tools" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> </div> <div class="md-source__repository"> optimade-python-tools </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../.." title="OPTIMADE Python tools"> OPTIMADE Python tools </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../install/" title="Installation"> Installation </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../configuration/" title="Configuration"> Configuration </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../CONTRIBUTING/" title="Contributing"> Contributing </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" id="nav-5" type="checkbox"/> <label class="md-nav__link" for="nav-5"> Use Cases <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="Use Cases" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="nav-5"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> Use Cases </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../../use_cases/single_db/" title="A single database"> A single database </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../use_cases/multi_db/" title="Multiple databases"> Multiple databases </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../use_cases/dynamic_db/" title="Dynamic databases"> Dynamic databases </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../CHANGELOG/" title="Changelog"> Changelog </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../all_models/" title="All models"> All models </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-8" id="nav-8" type="checkbox"/> <label class="md-nav__link" for="nav-8"> API Reference <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="API Reference" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="nav-8"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> API Reference </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-1" id="nav-8-1" type="checkbox"/> <label class="md-nav__link" for="nav-8-1"> adapters <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="adapters" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="nav-8-1"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> adapters </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/base/" title="base"> base </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/exceptions/" title="exceptions"> exceptions </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/logger/" title="logger"> logger </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-1-4" id="nav-8-1-4" type="checkbox"/> <label class="md-nav__link" for="nav-8-1-4"> references <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="references" class="md-nav" data-md-level="3"> <label class="md-nav__title" for="nav-8-1-4"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> references </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/references/adapter/" title="adapter"> adapter </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-1-5" id="nav-8-1-5" type="checkbox"/> <label class="md-nav__link" for="nav-8-1-5"> structures <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="structures" class="md-nav" data-md-level="3"> <label class="md-nav__title" for="nav-8-1-5"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> structures </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/adapter/" title="adapter"> adapter </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/aiida/" title="aiida"> aiida </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/ase/" title="ase"> ase </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/cif/" title="cif"> cif </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/jarvis/" title="jarvis"> jarvis </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/proteindatabank/" title="proteindatabank"> proteindatabank </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/pymatgen/" title="pymatgen"> pymatgen </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../adapters/structures/utils/" title="utils"> utils </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2" id="nav-8-2" type="checkbox"/> <label class="md-nav__link" for="nav-8-2"> filterparser <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="filterparser" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="nav-8-2"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> filterparser </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../filterparser/lark_parser/" title="lark_parser"> lark_parser </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-3" id="nav-8-3" type="checkbox"/> <label class="md-nav__link" for="nav-8-3"> filtertransformers <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="filtertransformers" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="nav-8-3"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> filtertransformers </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../filtertransformers/debug/" title="debug"> debug </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../filtertransformers/django/" title="django"> django </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../filtertransformers/elasticsearch/" title="elasticsearch"> elasticsearch </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../filtertransformers/json/" title="json"> json </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../filtertransformers/mongo/" title="mongo"> mongo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-4" id="nav-8-4" type="checkbox"/> <label class="md-nav__link" for="nav-8-4"> models <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="models" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="nav-8-4"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> models </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/baseinfo/" title="baseinfo"> baseinfo </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/entries/" title="entries"> entries </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/index_metadb/" title="index_metadb"> index_metadb </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/jsonapi/" title="jsonapi"> jsonapi </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/links/" title="links"> links </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/optimade_json/" title="optimade_json"> optimade_json </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/references/" title="references"> references </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/responses/" title="responses"> responses </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/structures/" title="structures"> structures </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../models/utils/" title="utils"> utils </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-5" id="nav-8-5" type="checkbox"/> <label class="md-nav__link" for="nav-8-5"> server <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="server" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="nav-8-5"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> server </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/config/" title="config"> config </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/exception_handlers/" title="exception_handlers"> exception_handlers </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/exceptions/" title="exceptions"> exceptions </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/logger/" title="logger"> logger </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/main/" title="main"> main </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/main_index/" title="main_index"> main_index </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/middleware/" title="middleware"> middleware </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/query_params/" title="query_params"> query_params </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/warnings/" title="warnings"> warnings </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-5-10" id="nav-8-5-10" type="checkbox"/> <label class="md-nav__link" for="nav-8-5-10"> entry_collections <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="entry_collections" class="md-nav" data-md-level="3"> <label class="md-nav__title" for="nav-8-5-10"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> entry_collections </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/entry_collections/entry_collections/" title="entry_collections"> entry_collections </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/entry_collections/mongo/" title="mongo"> mongo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-5-11" id="nav-8-5-11" type="checkbox"/> <label class="md-nav__link" for="nav-8-5-11"> mappers <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="mappers" class="md-nav" data-md-level="3"> <label class="md-nav__title" for="nav-8-5-11"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> mappers </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/mappers/entries/" title="entries"> entries </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/mappers/links/" title="links"> links </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/mappers/references/" title="references"> references </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/mappers/structures/" title="structures"> structures </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-5-12" id="nav-8-5-12" type="checkbox"/> <label class="md-nav__link" for="nav-8-5-12"> routers <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="routers" class="md-nav" data-md-level="3"> <label class="md-nav__title" for="nav-8-5-12"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> routers </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/index_info/" title="index_info"> index_info </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/info/" title="info"> info </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/landing/" title="landing"> landing </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/links/" title="links"> links </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/references/" title="references"> references </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/structures/" title="structures"> structures </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/utils/" title="utils"> utils </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../server/routers/versions/" title="versions"> versions </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-8-6" id="nav-8-6" type="checkbox"/> <label class="md-nav__link" for="nav-8-6"> validator <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg> </span> </label> <nav aria-label="validator" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="nav-8-6"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> validator </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> validator <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"></path></svg> </span> </label> <a class="md-nav__link md-nav__link--active" href="./" title="validator"> validator </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> Table of contents </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator"> optimade.validator.validator </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.Client"> Client </a> <nav aria-label="Client" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.Client.__init__"> __init__() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.Client.get"> get() </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator"> ImplementationValidator </a> <nav aria-label="ImplementationValidator" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.__init__"> __init__() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.deserialize_response"> deserialize_response() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.get_available_endpoints"> get_available_endpoints() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.get_endpoint"> get_endpoint() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.get_single_id_from_multi_endpoint"> get_single_id_from_multi_endpoint() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.main"> main() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_info_or_links_endpoints"> test_info_or_links_endpoints() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_multi_entry_endpoint"> test_multi_entry_endpoint() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_page_limit"> test_page_limit() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_query_syntax"> test_query_syntax() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_single_entry_endpoint"> test_single_entry_endpoint() </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.InternalError"> InternalError </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ResponseError"> ResponseError </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_failure"> print_failure() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_notify"> print_notify() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_success"> print_success() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_warning"> print_warning() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.test_case"> test_case() </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../validator_model_patches/" title="validator_model_patches"> validator_model_patches </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </span> Table of contents </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator"> optimade.validator.validator </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.Client"> Client </a> <nav aria-label="Client" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.Client.__init__"> __init__() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.Client.get"> get() </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator"> ImplementationValidator </a> <nav aria-label="ImplementationValidator" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.__init__"> __init__() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.deserialize_response"> deserialize_response() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.get_available_endpoints"> get_available_endpoints() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.get_endpoint"> get_endpoint() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.get_single_id_from_multi_endpoint"> get_single_id_from_multi_endpoint() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.main"> main() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_info_or_links_endpoints"> test_info_or_links_endpoints() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_multi_entry_endpoint"> test_multi_entry_endpoint() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_page_limit"> test_page_limit() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_query_syntax"> test_query_syntax() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ImplementationValidator.test_single_entry_endpoint"> test_single_entry_endpoint() </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.InternalError"> InternalError </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.ResponseError"> ResponseError </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_failure"> print_failure() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_notify"> print_notify() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_success"> print_success() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.print_warning"> print_warning() </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optimade.validator.validator.test_case"> test_case() </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content"> <article class="md-content__inner md-typeset"> <h1 id="validator">validator<a class="headerlink" href="#validator" title="Permanent link">¶</a></h1> <div class="doc doc-object doc-module"> <h2 class="hidden-toc" href="#optimade.validator.validator" id="optimade.validator.validator" style="visibility: hidden; width: 0; height: 0;"> <a class="headerlink" href="#optimade.validator.validator" title="Permanent link">¶</a></h2> <div class="doc doc-contents first"> <p>This module contains a validator class that can be pointed at an OPTIMADE implementation and validated against the pydantic models in this package.</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="optimade.validator.validator.Client"> <code>Client</code> <a class="headerlink" href="#optimade.validator.validator.Client" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.Client.__init__"> <code class="highlight language-python"> __init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> </code> <span class="doc doc-properties"> <small class="doc doc-property doc-property-special"><code>special</code></small> </span> <a class="headerlink" href="#optimade.validator.validator.Client.__init__" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Initialises the Client with the given <code>base_url</code> without testing if it is valid.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>base_url</code></td> <td><code>str</code></td> <td> <p>the base URL of the optimade implementation, including request protocol (e.g. <code>'http://'</code>) and API version number if necessary.</p> <p>Examples:</p> <ul> <li><code>'http://example.org/optimade/v1'</code></li> <li><code>'www.crystallography.net/cod-test/optimade/v0.10.0/'</code></li> </ul> <p>Note: A maximum of one slash ("/") is allowed as the last character.</p> </td> <td><em>required</em></td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">""" Initialises the Client with the given `base_url` without testing</span>
<span class="sd">    if it is valid.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        base_url (str): the base URL of the optimade implementation, including</span>
<span class="sd">            request protocol (e.g. `'http://'`) and API version number if necessary.</span>

<span class="sd">            Examples:</span>

<span class="sd">            - `'http://example.org/optimade/v1'`</span>
<span class="sd">            - `'www.crystallography.net/cod-test/optimade/v0.10.0/'`</span>

<span class="sd">            Note: A maximum of one slash ("/") is allowed as the last character.</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_request</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.Client.get"> <code class="highlight language-python"> get<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.Client.get" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Makes the given request, with a number of retries if being rate limited. The request will be prepended with the <code>base_url</code> unless the request appears to be an absolute URL (i.e. starts with <code>http://</code> or <code>https://</code>).</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>request</code></td> <td><code>str</code></td> <td> <p>the request to make against the base URL of this client.</p> </td> <td><em>required</em></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>response (requests.models.Response)</code></td> <td> <p>the response from the server.</p> </td> </tr> </tbody> </table> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>SystemExit</code></td> <td> <p>if there is no response from the server, or if the URL is invalid.</p> </td> </tr> <tr> <td><code>ResponseError</code></td> <td> <p>if the server does not respond with a non-429 status code within the <code>MAX_RETRIES</code> attempts.</p> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">""" Makes the given request, with a number of retries if being rate limited. The</span>
<span class="sd">    request will be prepended with the `base_url` unless the request appears to be an</span>
<span class="sd">    absolute URL (i.e. starts with `http://` or `https://`).</span>

<span class="sd">    Parameters:</span>
<span class="sd">        request (str): the request to make against the base URL of this client.</span>

<span class="sd">    Returns:</span>
<span class="sd">        response (requests.models.Response): the response from the server.</span>

<span class="sd">    Raises:</span>
<span class="sd">        SystemExit: if there is no response from the server, or if the URL is invalid.</span>
<span class="sd">        ResponseError: if the server does not respond with a non-429 status code within</span>
<span class="sd">            the `MAX_RETRIES` attempts.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_request</span> <span class="o">=</span> <span class="n">request</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"/"</span><span class="p">):</span>
            <span class="n">request</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"/</span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2">"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_request</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}{</span><span class="n">request</span><span class="si">}</span><span class="s2">"</span>

    <span class="n">status_code</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># probably a smarter way to do this with requests, but their documentation 404's...</span>
    <span class="k">while</span> <span class="n">retries</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">:</span>
        <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_request</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">"No response from server at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_request</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">MissingSchema</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Unable to make request on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_request</span><span class="si">}</span><span class="s2">, did you mean http://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_request</span><span class="si">}</span><span class="s2">?"</span>
            <span class="p">)</span>
        <span class="n">status_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="n">status_code</span> <span class="o">!=</span> <span class="mi">429</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">"Hit rate limit, sleeping for 1 s..."</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span><span class="s2">"Hit max (manual) retries on request."</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator"> <code>ImplementationValidator</code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>Class to call test functions on a particular OPTIMADE implementation.</p> <p>Uses the pydantic models in <code>optimade.models</code> to validate the response from the server and crawl through the available endpoints.</p> <div class="admonition caution"> <p class="admonition-title">Caution</p> <p>Only works for current version of the specification as defined by <code>optimade.models</code>.</p> </div> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.__init__"> <code class="highlight language-python"> __init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">page_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">run_optional_tests</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fail_fast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code> <span class="doc doc-properties"> <small class="doc doc-property doc-property-special"><code>special</code></small> </span> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.__init__" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Set up the tests to run, based on constants in this module for required endpoints.</p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Client</span><span class="p">,</span> <span class="n">TestClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">page_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">run_optional_tests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">fail_fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">as_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">""" Set up the tests to run, based on constants in this module</span>
<span class="sd">    for required endpoints.</span>

<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">page_limit</span> <span class="o">=</span> <span class="n">page_limit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_optional_tests</span> <span class="o">=</span> <span class="n">run_optional_tests</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fail_fast</span> <span class="o">=</span> <span class="n">fail_fast</span>

    <span class="k">if</span> <span class="n">as_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_type_cls</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">as_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RESPONSE_CLASSES_INDEX</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Provided as_type='</span><span class="si">{</span><span class="n">as_type</span><span class="si">}</span><span class="s2">' not allowed for an Index meta-database."</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_type_cls</span> <span class="o">=</span> <span class="n">RESPONSE_CLASSES_INDEX</span><span class="p">[</span><span class="n">as_type</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">as_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"structure"</span><span class="p">,</span> <span class="s2">"reference"</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_type_cls</span> <span class="o">=</span> <span class="n">RESPONSE_CLASSES</span><span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">as_type</span><span class="si">}</span><span class="s2">s/"</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_type_cls</span> <span class="o">=</span> <span class="n">RESPONSE_CLASSES</span><span class="p">[</span><span class="n">as_type</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">base_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">"Need at least a URL or a client to initialize validator."</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">base_url</span> <span class="ow">and</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Please specify at most one of base_url or client."</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">client</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">base_url</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">base_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"/"</span><span class="p">):</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">test_id_by_type</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_log</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expected_entry_endpoints</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">REQUIRED_ENTRY_ENDPOINTS_INDEX</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="n">REQUIRED_ENTRY_ENDPOINTS</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_entry_endpoints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_entry_endpoints</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_mandatory_queries</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="n">ENDPOINT_MANDATORY_QUERIES</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_optional_queries</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="n">ENDPOINT_OPTIONAL_QUERIES</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">response_classes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">RESPONSE_CLASSES_INDEX</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="n">RESPONSE_CLASSES</span>
    <span class="p">)</span>

    <span class="c1"># some simple checks on base_url</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
    <span class="c1"># only allow filters/endpoints if we are working in "as_type" mode</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_type_cls</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">base_url</span><span class="o">.</span><span class="n">query</span>
        <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">endp</span> <span class="ow">in</span> <span class="n">base_url</span><span class="o">.</span><span class="n">path</span> <span class="k">for</span> <span class="n">endp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_entry_endpoints</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span>
            <span class="s2">"Base URL not appropriate: should not contain an endpoint or filter."</span>
        <span class="p">)</span>

    <span class="c1"># if valid is True on exit, script returns 0 to shell</span>
    <span class="c1"># if valid is False on exit, script returns 1 to shell</span>
    <span class="c1"># if valid is None on exit, script returns 2 to shell, indicating an internal failure</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">internal_failure_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optional_success_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optional_failure_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">failure_messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">internal_failure_messages</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.deserialize_response"> <code class="highlight language-python"> deserialize_response<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">response_cls</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.deserialize_response" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Try to create the appropriate pydantic model from the response. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="nd">@test_case</span>
<span class="k">def</span> <span class="nf">deserialize_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">response_cls</span><span class="p">):</span>
    <span class="sd">""" Try to create the appropriate pydantic model from the response. """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span><span class="s2">"Request failed"</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Unable to decode response as JSON. Response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Deserializing </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> as model </span><span class="si">{</span><span class="n">response_cls</span><span class="si">}</span><span class="s2">"</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">response_cls</span><span class="p">(</span><span class="o">**</span><span class="n">json_response</span><span class="p">),</span>
        <span class="s2">"deserialized correctly as object of type </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response_cls</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.get_available_endpoints"> <code class="highlight language-python"> get_available_endpoints<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_info</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.get_available_endpoints" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Try to get <code>entry_types_by_format</code> even if base info response could not be validated. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="nd">@test_case</span>
<span class="k">def</span> <span class="nf">get_available_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_info</span><span class="p">):</span>
    <span class="sd">""" Try to get `entry_types_by_format` even if base info response could not be validated. """</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">available_json_entry_endpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">available_json_entry_endpoints</span> <span class="o">=</span> <span class="n">base_info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">entry_types_by_format</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">"json"</span>
            <span class="p">)</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">"Info endpoint failed serialization, trying to manually extract entry_types_by_format."</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_info</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
                <span class="s2">"Unable to get entry types from base info endpoint. "</span>
                <span class="sa">f</span><span class="s2">"This may most likely be attributed to a wrong request to the '</span><span class="si">{</span><span class="n">BASE_INFO_ENDPOINT</span><span class="si">}</span><span class="s2">' endpoint."</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">available_json_entry_endpoints</span> <span class="o">=</span> <span class="n">base_info</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"data"</span><span class="p">][</span><span class="s2">"attributes"</span><span class="p">][</span>
                <span class="s2">"entry_types_by_format"</span>
            <span class="p">][</span><span class="s2">"json"</span><span class="p">]</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
                <span class="s2">"Unable to get entry_types_by_format from unserializable base info response </span><span class="si">{}</span><span class="s2">."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">base_info</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
            <span class="s2">"Unable to find any JSON entry types in entry_types_by_format"</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">and</span> <span class="n">available_json_entry_endpoints</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
            <span class="s2">"No entry endpoint are allowed for an Index meta-database"</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">test_entry_endpoints</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">available_json_entry_endpoints</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">non_entry_endpoint</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"info"</span><span class="p">,</span> <span class="s2">"links"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">non_entry_endpoint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_entry_endpoints</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">'Illegal entry "</span><span class="si">{</span><span class="n">non_entry_endpoint</span><span class="si">}</span><span class="s1">" was found in entry_types_by_format"'</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">available_json_entry_endpoints</span><span class="p">,</span>
        <span class="s2">"successfully found available entry types in baseinfo"</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.get_endpoint"> <code class="highlight language-python"> get_endpoint<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.get_endpoint" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Gets the response from the endpoint specified by <code>request_str</code>. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="nd">@test_case</span>
<span class="k">def</span> <span class="nf">get_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">""" Gets the response from the endpoint specified by `request_str`. """</span>

    <span class="n">request_str</span> <span class="o">=</span> <span class="n">request_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">request_str</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Request to '</span><span class="si">{</span><span class="n">request_str</span><span class="si">}</span><span class="s2">' returned HTTP code </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">."</span>
        <span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Error(s):"</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"errors"</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">'</span><span class="se">\n</span><span class="s1">  </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"detail"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">)</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"source"</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"pointer"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">)</span><span class="si">}</span><span class="s1">)'</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="s2">"request successful."</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.get_single_id_from_multi_endpoint"> <code class="highlight language-python"> get_single_id_from_multi_endpoint<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deserialized</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.get_single_id_from_multi_endpoint" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Scrape an ID from the multi-entry endpoint to use as query for single entry endpoint.</p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="nd">@test_case</span>
<span class="k">def</span> <span class="nf">get_single_id_from_multi_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deserialized</span><span class="p">):</span>
    <span class="sd">""" Scrape an ID from the multi-entry endpoint to use as query</span>
<span class="sd">    for single entry endpoint.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">deserialized</span> <span class="ow">and</span> <span class="n">deserialized</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_id_by_type</span><span class="p">[</span><span class="n">deserialized</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">]</span> <span class="o">=</span> <span class="n">deserialized</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">"Set type </span><span class="si">%s</span><span class="s2"> test ID to </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">deserialized</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="n">deserialized</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
            <span class="s2">"No entries found under endpoint to scrape ID from. "</span>
            <span class="s2">"This may be caused by previous errors, if e.g. the endpoint failed deserialization."</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_id_by_type</span><span class="p">[</span><span class="n">deserialized</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">],</span>
        <span class="sa">f</span><span class="s2">"successfully scraped test ID from </span><span class="si">{</span><span class="n">deserialized</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> endpoint"</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.main"> <code class="highlight language-python"> main<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.main" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Run all the test cases of the implementation, or the single type test. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Run all the test cases of the implementation, or the single type test. """</span>

    <span class="c1"># if single type has been set, only run that test</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_type_cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">"Validating response of </span><span class="si">%s</span><span class="s2"> with model </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">as_type_cls</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_as_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># test entire implementation</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Testing entire implementation at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Mandatory tests:"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Testing base info endpoint of </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">BASE_INFO_ENDPOINT</span><span class="p">)</span>
    <span class="n">base_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_info_or_links_endpoints</span><span class="p">(</span><span class="n">BASE_INFO_ENDPOINT</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_available_endpoints</span><span class="p">(</span><span class="n">base_info</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">endp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_entry_endpoints</span><span class="p">:</span>
        <span class="n">entry_info_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">BASE_INFO_ENDPOINT</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">endp</span><span class="si">}</span><span class="s2">"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Testing expected info endpoint </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">entry_info_endpoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_info_or_links_endpoints</span><span class="p">(</span><span class="n">entry_info_endpoint</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">endp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_entry_endpoints</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Testing multiple entry endpoint of </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">endp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_multi_entry_endpoint</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">endp</span><span class="si">}</span><span class="s2">?page_limit=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">page_limit</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">endp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_entry_endpoints</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Testing single entry request of type </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">endp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_single_entry_endpoint</span><span class="p">(</span><span class="n">endp</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">endp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_mandatory_queries</span><span class="p">:</span>
        <span class="c1"># skip empty endpoint query lists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_mandatory_queries</span><span class="p">[</span><span class="n">endp</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Testing mandatory query syntax on endpoint </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">endp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_query_syntax</span><span class="p">(</span><span class="n">endp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_mandatory_queries</span><span class="p">[</span><span class="n">endp</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Testing </span><span class="si">%s</span><span class="s2"> endpoint"</span><span class="p">,</span> <span class="n">LINKS_ENDPOINT</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_info_or_links_endpoints</span><span class="p">(</span><span class="n">LINKS_ENDPOINT</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_failure_count</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_optional_tests</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Optional tests:"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">endp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_optional_queries</span><span class="p">:</span>
            <span class="c1"># skip empty endpoint query lists</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_mandatory_queries</span><span class="p">[</span><span class="n">endp</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">"Testing optional query syntax on endpoint </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">endp</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test_query_syntax</span><span class="p">(</span>
                    <span class="n">endp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_optional_queries</span><span class="p">[</span><span class="n">endp</span><span class="p">],</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.test_info_or_links_endpoints"> <code class="highlight language-python"> test_info_or_links_endpoints<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.test_info_or_links_endpoints" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Runs the test cases for the info endpoints. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>503
504
505
506
507
508
509
510
511
512
513</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">test_info_or_links_endpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">):</span>
    <span class="sd">""" Runs the test cases for the info endpoints. """</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_endpoint</span><span class="p">(</span><span class="n">request_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_response</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_classes</span><span class="p">[</span><span class="n">request_str</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deserialized</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">return</span> <span class="n">deserialized</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.test_multi_entry_endpoint"> <code class="highlight language-python"> test_multi_entry_endpoint<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.test_multi_entry_endpoint" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Runs the test cases for the multi entry endpoints. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>533
534
535
536
537
538
539
540
541
542
543
544
545
546
547</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">test_multi_entry_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">):</span>
    <span class="sd">""" Runs the test cases for the multi entry endpoints. """</span>
    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_endpoint</span><span class="p">(</span><span class="n">request_str</span><span class="p">)</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="n">request_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"?"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_classes</span><span class="p">:</span>
        <span class="n">response_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_classes</span><span class="p">[</span><span class="n">_type</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">"Deserializing multi entry response from </span><span class="si">%s</span><span class="s2"> with generic response rather than defined endpoint."</span><span class="p">,</span>
            <span class="n">_type</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_cls</span> <span class="o">=</span> <span class="n">ValidatorEntryResponseMany</span>
    <span class="n">deserialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">response_cls</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_page_limit</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_single_id_from_multi_endpoint</span><span class="p">(</span><span class="n">deserialized</span><span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.test_page_limit"> <code class="highlight language-python"> test_page_limit<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">check_next_link</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.test_page_limit" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Test that a multi-entry endpoint obeys the page limit.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>response</code></td> <td><code>requests.Response</code></td> <td> <p>the response to test for page limit compliance.</p> </td> <td><em>required</em></td> </tr> </tbody> </table> <p>Keyword arguments: check_next_link (int): maximum recursion depth for following pagination links.</p> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>ResponseError</code></td> <td> <p>if test fails in a predictable way.</p> </td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>bool, str</code></td> <td> <p>True if the test was successful, with a string describing the success.</p> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="nd">@test_case</span>
<span class="k">def</span> <span class="nf">test_page_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">check_next_link</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
    <span class="sd">""" Test that a multi-entry endpoint obeys the page limit.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        response (requests.Response): the response to test for page limit</span>
<span class="sd">            compliance.</span>

<span class="sd">    Keyword arguments:</span>
<span class="sd">        check_next_link (int): maximum recursion depth for following</span>
<span class="sd">            pagination links.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ResponseError: if test fails in a predictable way.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool, str: True if the test was successful, with a string describing</span>
<span class="sd">            the success.</span>

<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span><span class="s2">"Unable to test endpoint page limit."</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">num_entries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">"data"</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
            <span class="s2">"Response under `data` field was missing or had wrong type."</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">num_entries</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_limit</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Endpoint did not obey page limit: </span><span class="si">{</span><span class="n">num_entries</span><span class="si">}</span><span class="s2"> entries vs </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">page_limit</span><span class="si">}</span><span class="s2"> limit"</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">more_data_available</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">"meta"</span><span class="p">][</span><span class="s2">"more_data_available"</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span><span class="s2">"Field `meta-&gt;more_data_available` was missing."</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">more_data_available</span> <span class="ow">and</span> <span class="n">check_next_link</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">next_link</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">"links"</span><span class="p">][</span><span class="s2">"next"</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">next_link</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">next_link</span> <span class="o">=</span> <span class="n">next_link</span><span class="p">[</span><span class="s2">"href"</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
                <span class="s2">"Endpoint suggested more data was available but provided no valid links-&gt;next link."</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">next_link</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ResponseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Unable to parse links-&gt;next </span><span class="si">{</span><span class="n">next_link</span><span class="si">!r}</span><span class="s2"> as a link."</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Following pagination link to </span><span class="si">%r</span><span class="s2">."</span><span class="p">,</span> <span class="n">next_link</span><span class="p">)</span>
        <span class="n">next_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_endpoint</span><span class="p">(</span><span class="n">next_link</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_page_limit</span><span class="p">(</span><span class="n">next_response</span><span class="p">,</span> <span class="n">check_next_link</span><span class="o">=</span><span class="n">check_next_link</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="kc">True</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">"Endpoint obeyed page limit of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">page_limit</span><span class="si">}</span><span class="s2"> by returning </span><span class="si">{</span><span class="n">num_entries</span><span class="si">}</span><span class="s2"> entries."</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.test_query_syntax"> <code class="highlight language-python"> test_query_syntax<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">endpoint_queries</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.test_query_syntax" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Execute a list of valid queries agains the endpoint and assert that no errors are raised.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>endpoint</code></td> <td><code>str</code></td> <td> <p>the endpoint to query (e.g. "structures").</p> </td> <td><em>required</em></td> </tr> <tr> <td><code>endpoint_queries</code></td> <td><code>list</code></td> <td> <p>the list of valid mandatory queries for that endpoint, where the queries do not include the "?filter=" prefix, e.g. ['elements HAS "Na"'].</p> </td> <td><em>required</em></td> </tr> </tbody> </table> <p>Keyword arguments: optional (bool): treat the success of the queries as optional.</p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">test_query_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">endpoint_queries</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">""" Execute a list of valid queries agains the endpoint and assert</span>
<span class="sd">    that no errors are raised.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        endpoint (str): the endpoint to query (e.g. "structures").</span>
<span class="sd">        endpoint_queries (list): the list of valid mandatory queries</span>
<span class="sd">            for that endpoint, where the queries do not include the</span>
<span class="sd">            "?filter=" prefix, e.g. ['elements HAS "Na"'].</span>

<span class="sd">    Keyword arguments:</span>
<span class="sd">        optional (bool): treat the success of the queries as optional.</span>

<span class="sd">    """</span>

    <span class="n">valid_queries</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">?filter=</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">endpoint_queries</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">valid_queries</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_endpoint</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="n">optional</span><span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-method"> <h3 class="doc doc-heading" id="optimade.validator.validator.ImplementationValidator.test_single_entry_endpoint"> <code class="highlight language-python"> test_single_entry_endpoint<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.ImplementationValidator.test_single_entry_endpoint" title="Permanent link">¶</a></h3> <div class="doc doc-contents"> <p>Runs the test cases for the single entry endpoints. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">test_single_entry_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_str</span><span class="p">):</span>
    <span class="sd">""" Runs the test cases for the single entry endpoints. """</span>
    <span class="n">_type</span> <span class="o">=</span> <span class="n">request_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"?"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">response_cls_name</span> <span class="o">=</span> <span class="n">_type</span> <span class="o">+</span> <span class="s2">"/"</span>
    <span class="k">if</span> <span class="n">response_cls_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_classes</span><span class="p">:</span>
        <span class="n">response_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_classes</span><span class="p">[</span><span class="n">response_cls_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">"Deserializing single entry response </span><span class="si">%s</span><span class="s2"> with generic response rather than defined endpoint."</span><span class="p">,</span>
            <span class="n">_type</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_cls</span> <span class="o">=</span> <span class="n">ValidatorEntryResponseOne</span>
    <span class="k">if</span> <span class="n">_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_id_by_type</span><span class="p">:</span>
        <span class="n">test_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_id_by_type</span><span class="p">[</span><span class="n">_type</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_endpoint</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">test_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">response_cls</span><span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="optimade.validator.validator.InternalError"> <code>InternalError</code> <a class="headerlink" href="#optimade.validator.validator.InternalError" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>This exception should be raised when validation throws an unexpected error. These should be counted separately from <code>ResponseError</code>'s and <code>ValidationError</code>'s.</p> </div> </div> <div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="optimade.validator.validator.ResponseError"> <code>ResponseError</code> <a class="headerlink" href="#optimade.validator.validator.ResponseError" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>This exception should be raised for a manual hardcoded test failure. </p> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading" id="optimade.validator.validator.print_failure"> <code class="highlight language-python"> print_failure<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.print_failure" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>Print but sad. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>79
80
81</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">print_failure</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">""" Print but sad. """</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[91m</span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading" id="optimade.validator.validator.print_notify"> <code class="highlight language-python"> print_notify<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.print_notify" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>Print but louder. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>74
75
76</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">print_notify</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">""" Print but louder. """</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[94m</span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading" id="optimade.validator.validator.print_success"> <code class="highlight language-python"> print_success<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.print_success" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>Print but happy. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>84
85
86</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">print_success</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">""" Print but happy. """</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[92m</span><span class="se">\033</span><span class="s2">[1m</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading" id="optimade.validator.validator.print_warning"> <code class="highlight language-python"> print_warning<span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.print_warning" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>Print but angry. </p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>69
70
71</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">print_warning</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">""" Print but angry. """</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\033</span><span class="s2">[93m</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 class="doc doc-heading" id="optimade.validator.validator.test_case"> <code class="highlight language-python"> test_case<span class="p">(</span><span class="n">test_fn</span><span class="p">)</span> </code> <a class="headerlink" href="#optimade.validator.validator.test_case" title="Permanent link">¶</a></h2> <div class="doc doc-contents"> <p>Wrapper for test case functions, which pretty_prints any errors depending on verbosity level and returns only the response to the caller.</p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>test_fn</code></td> <td><code>callable</code></td> <td> <p>function that returns a response to pass to caller, and a message to print upon success. Should raise <code>ResponseError</code>, <code>ValidationError</code> or <code>ManualValidationError</code> if the test case has failed.</p> </td> <td><em>required</em></td> </tr> </tbody> </table> <p>Keyword arguments: optional (bool): whether or not to treat the test as optional.</p> <details class="quote"> <summary>Source code in <code>optimade/validator/validator.py</code></summary> <table class="highlighttable"> <tr> <td class="linenos"> <div class="linenodiv"> <pre><span></span>172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283</pre> </div> </td> <td class="code"> <div class="highlight"> <pre><span></span><code><span class="k">def</span> <span class="nf">test_case</span><span class="p">(</span><span class="n">test_fn</span><span class="p">):</span>
    <span class="sd">""" Wrapper for test case functions, which pretty_prints any errors</span>
<span class="sd">    depending on verbosity level and returns only the response to the caller.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        test_fn (callable): function that returns a response to pass to caller,</span>
<span class="sd">            and a message to print upon success. Should raise `ResponseError`,</span>
<span class="sd">            `ValidationError` or `ManualValidationError` if the test case has failed.</span>

<span class="sd">    Keyword arguments:</span>
<span class="sd">        optional (bool): whether or not to treat the test as optional.</span>

<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">test_fn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">test_fn</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">"Critical: unable to parse server response as JSON. "</span>
                    <span class="sa">f</span><span class="s2">"Error: </span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">exc</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">ResponseError</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">"</span>
                <span class="k">raise</span> <span class="n">exc</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">exc</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">"</span>
                <span class="k">raise</span> <span class="n">InternalError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">exc</span>
            <span class="n">traceback</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">last_request</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">base_url</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">optional</span><span class="p">:</span>
                    <span class="n">validator</span><span class="o">.</span><span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">validator</span><span class="o">.</span><span class="n">optional_success_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"✔: </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">"</span>
                <span class="k">if</span> <span class="n">validator</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">optional</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">print_success</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">optional</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">print_success</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">internal_error</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">validator</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># ValidationErrors from pydantic already include very detailed errors</span>
                    <span class="c1"># that get duplicated in the traceback</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">+=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">InternalError</span><span class="p">):</span>
                    <span class="n">internal_error</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">validator</span><span class="o">.</span><span class="n">internal_failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"!: </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">test_fn</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> - failed with internal error"</span>
                    <span class="n">validator</span><span class="o">.</span><span class="n">internal_failure_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">summary</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">optional</span><span class="p">:</span>
                        <span class="n">validator</span><span class="o">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">validator</span><span class="o">.</span><span class="n">optional_failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"✖: </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">test_fn</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> - failed with error"</span>
                    <span class="n">validator</span><span class="o">.</span><span class="n">failure_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">summary</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">validator</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">internal_error</span><span class="p">:</span>
                        <span class="n">print_notify</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                            <span class="n">print_warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">optional</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">print_failure</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                            <span class="n">print_warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">internal_error</span><span class="p">:</span>
                        <span class="n">print_notify</span><span class="p">(</span><span class="s2">"!"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">optional</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">"✖"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">print_failure</span><span class="p">(</span><span class="s2">"✖"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># set failure result to None as this is expected by other functions</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">validator</span><span class="o">.</span><span class="n">fail_fast</span><span class="p">:</span>
                    <span class="n">validator</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">SystemExit</span>

            <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre> </div> </td> </tr> </table> </details> </div> </div> </div> </div> </div> </article> </div> </div> </main> <footer class="md-footer"> <div class="md-footer-nav"> <nav aria-label="Footer" class="md-footer-nav__inner md-grid"> <a class="md-footer-nav__link md-footer-nav__link--prev" href="../../server/routers/versions/" rel="prev" title="versions"> <div class="md-footer-nav__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg> </div> <div class="md-footer-nav__title"> <div class="md-ellipsis"> <span class="md-footer-nav__direction"> Previous </span> versions </div> </div> </a> <a class="md-footer-nav__link md-footer-nav__link--next" href="../validator_model_patches/" rel="next" title="validator_model_patches"> <div class="md-footer-nav__title"> <div class="md-ellipsis"> <span class="md-footer-nav__direction"> Next </span> validator_model_patches </div> </div> <div class="md-footer-nav__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-footer-copyright"> <div class="md-footer-copyright__highlight"> Built by the Materials-Consortia </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> <div class="md-footer-social"> <a class="md-footer-social__link" href="https://github.com/Materials-Consortia" rel="noopener" target="_blank" title="github.com"> <svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> </a> </div> </div> </div> </footer> </div> <script src="../../../assets/javascripts/vendor.c3dc8c49.min.js"></script> <script src="../../../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>